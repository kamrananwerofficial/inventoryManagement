
<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Low Stock Items</h1>
    <a routerLink="/items" class="btn btn-outline-primary">
      <i class="fas fa-arrow-left me-2"></i>Back to All Items
    </a>
  </div>
  
  <div class="alert alert-warning" *ngIf="lowStockItems.length > 0">
    <i class="fas fa-exclamation-triangle me-2"></i>
    <strong>Attention:</strong> The following items are below their reorder levels and need to be restocked.
  </div>
  
  <div class="alert alert-success" *ngIf="lowStockItems.length === 0">
    <i class="fas fa-check-circle me-2"></i>
    <strong>Good job!</strong> All items are above their reorder levels.
  </div>
  
  <div class="row">
    <div class="col-md-6 mb-4" *ngFor="let item of lowStockItems">
      <div class="card h-100">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">{{ item.name }}</h5>
          <span class="badge rounded-pill" [ngClass]="getStockStatus(item).class">
            {{ getStockStatus(item).status }}
          </span>
        </div>
        <div class="card-body">
          <div class="row mb-3">
            <div class="col-md-6">
              <p class="mb-1"><strong>SKU:</strong> {{ item.sku }}</p>
              <p class="mb-1"><strong>Category:</strong> {{ item.category }}</p>
            </div>
            <div class="col-md-6">
              <p class="mb-1"><strong>Cost Price:</strong> ${{ item.costPrice | number:'1.2-2' }}</p>
              <p class="mb-1"><strong>Selling Price:</strong> ${{ item.unitPrice | number:'1.2-2' }}</p>
            </div>
          </div>
          
          <div class="mb-3">
            <div class="d-flex justify-content-between mb-1">
              <span><strong>Current Stock:</strong> {{ item.quantity }}</span>
              <span><strong>Reorder Level:</strong> {{ item.reorderLevel }}</span>
            </div>
            <div class="progress">
              <div class="progress-bar" 
                  [ngClass]="{'bg-danger': item.quantity <= 0, 'bg-warning': item.quantity > 0}"
                  [style.width.%]="getStockPercentage(item)">
                {{ getStockPercentage(item) }}%
              </div>
            </div>
          </div>
          
          <div class="d-flex justify-content-between align-items-center">
            <a [routerLink]="['/items/detail', item.id]" class="btn btn-sm btn-outline-primary">
              <i class="fas fa-eye me-1"></i>View Details
            </a>
            <button class="btn btn-sm btn-success" (click)="openPurchaseModal(purchaseModal, item)">
              <i class="fas fa-shopping-cart me-1"></i>Create Purchase Order
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Purchase Modal -->
<ng-template #purchaseModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Create Purchase Order</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <div class="alert alert-info" *ngIf="selectedItem">
      <div class="d-flex justify-content-between">
        <span><strong>Item:</strong> {{ selectedItem.name }}</span>
        <span><strong>SKU:</strong> {{ selectedItem.sku }}</span>
      </div>
      <div class="d-flex justify-content-between">
        <span><strong>Current Stock:</strong> {{ selectedItem.quantity }}</span>
        <span><strong>Reorder Level:</strong> {{ selectedItem.reorderLevel }}</span>
      </div>
    </div>
    
    <form [formGroup]="purchaseForm">
      <div class="mb-3">
        <label for="quantity" class="form-label">Purchase Quantity*</label>
        <input type="number" class="form-control" id="quantity" formControlName="quantity" min="1">
      </div>
      
      <div class="mb-3">
        <label for="costPrice" class="form-label">Cost Price Per Unit*</label>
        <div class="input-group">
          <span class="input-group-text">$</span>
          <input type="number" class="form-control" id="costPrice" formControlName="costPrice" step="0.01">
        </div>
      </div>
      
      <div class="mb-3">
        <label for="supplierName" class="form-label">Supplier Name*</label>
        <input type="text" class="form-control" id="supplierName" formControlName="supplierName">
      </div>
      
      <div class="mb-3">
        <label for="reference" class="form-label">Purchase Reference*</label>
        <input type="text" class="form-control" id="reference" formControlName="reference">
      </div>
      
      <div class="mb-3">
        <label for="notes" class="form-label">Notes</label>
        <textarea class="form-control" id="notes" rows="2" formControlName="notes"></textarea>
      </div>
      
      <div class="alert alert-primary" *ngIf="purchaseForm.valid && selectedItem">
        <strong>Order Summary:</strong><br>
        {{ purchaseForm.value.quantity }} units \u00d7 ${{ purchaseForm.value.costPrice | number:'1.2-2' }} = 
        ${{ purchaseForm.value.quantity * purchaseForm.value.costPrice | number:'1.2-2' }}
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cancel</button>
    <button type="button" class="btn btn-success" (click)="submitPurchase()" 
            [disabled]="purchaseForm.invalid">
      Create Purchase Order
    </button>
  </div>
</ng-template>
